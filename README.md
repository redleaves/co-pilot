# 🔄 研发效能协作智能体 | DevOps Co-pilot

一个 AI 驱动的沟通翻译助手，帮助产品经理和开发工程师跨越专业语言鸿沟，实现高效协作。

## ✨ 核心功能

- **🎯 零配置场景识别**：自动识别输入是「产品语言」还是「技术语言」
- **📝 双向翻译**：
  - 产品→开发：翻译为技术方案、数据依赖、工作量评估、技术风险、待确认问题
  - 开发→产品：翻译为用户体验影响、业务价值、成本效率、可宣传亮点、后续可能性
- **💬 多轮对话**：支持上下文关联的持续对话
- **📂 会话持久化**：自动保存对话历史，支持关闭浏览器后恢复
- **🤔 智能追问**：信息不足时主动追问，引导用户补充关键信息
- **⚡ 流式输出**：SSE 实时流式渲染，体验流畅

## 🚀 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 配置环境变量

在 `.env.local` 文件配置 api 密钥：

```bash
# DeepSeek API 配置
DEEPSEEK_API_KEY=your_api_key_here
```

### 3. 启动开发服务器

```bash
npm run dev
```

### 4. 访问应用

打开浏览器访问 [http://localhost:3000](http://localhost:3000)

## 📁 项目结构

```
co-pilot/
├── app/
│   ├── api/
│   │   ├── translate/route.ts    # 翻译 API（SSE 流式）
│   │   └── session/
│   │       ├── route.ts          # 会话 CRUD API
│   │       └── persist/route.ts  # 会话持久化 API
│   ├── layout.tsx
│   ├── page.tsx
│   └── globals.css
├── components/
│   ├── Header.tsx                # 顶部导航
│   ├── SessionBar.tsx            # 会话列表侧边栏
│   ├── InputPanel.tsx            # 输入面板
│   ├── OutputPanel.tsx           # 输出面板（Markdown 渲染）
│   └── ChatHistory.tsx           # 对话历史
├── hooks/
│   ├── useTranslate.ts           # 翻译 Hook（SSE 处理）
│   └── useSession.ts             # 会话管理 Hook
├── lib/
│   ├── llm/
│   │   ├── config.ts             # LLM 配置
│   │   └── client.ts             # LLM 客户端（流式调用）
│   ├── prompts/
│   │   └── system-prompt.ts      # System Prompt 定义
│   ├── session/
│   │   ├── types.ts              # 会话类型定义
│   │   ├── index-log.ts          # Append-Only JSONL 索引
│   │   ├── storage.ts            # Markdown 存储
│   │   └── persist.ts            # 异步持久化
│   ├── logger.ts                 # 日志工具
│   ├── trace.ts                  # TraceId 生成
│   └── types.ts                  # 全局类型
├── sessions/                     # 会话存储目录
│   └── _index.jsonl              # 会话索引文件
└── docs/
    ├── design.md                 # 技术设计文档
    ├── test.md                   # 测试用例文档
    └── tasks.md                  # 任务清单
```

## 🛠️ 技术栈

- **框架**：Next.js 14 (App Router)
- **语言**：TypeScript
- **样式**：TailwindCSS
- **LLM**：DeepSeek API（通过 OpenAI SDK）
- **流式输出**：Server-Sent Events (SSE)
- **存储**：文件系统（Markdown + JSONL）

## 📖 使用示例

### 产品经理输入

```
我们需要一个智能推荐功能，根据用户的浏览历史推荐商品，目标是提升转化率
```

### 系统输出

系统会自动识别输入类型，并翻译为对方能理解的语言。详见下方测试用例。

---

## 📋 测试用例

### 用例1：产品视角输入（产品→开发）

**输入**：
```
我们需要在APP里增加一个会员积分系统，用户消费可以获得积分，积分可以兑换优惠券
```

**输出**：

> **🎯 识别结果**
>
> **当前识别为**：【产品→开发】
>
> **识别依据**：输入使用了"需要"、"会员积分系统"、"用户消费"、"兑换优惠券"等典型业务/产品功能描述词汇，核心关注点是"做什么"（新增一个功能模块）以及该功能的业务逻辑和目标。
>
> ---
>
> **📝 翻译内容**
>
> **1. 技术方案概述**
> - **积分账户服务**：核心微服务，负责用户积分账户的创建、积分余额的增/减/查，确保数据强一致性
> - **积分发放规则引擎**：根据"消费"行为动态计算应得积分，规则需要可配置
> - **积分消耗/兑换服务**：处理用户用积分兑换优惠券的请求，涉及积分扣减与优惠券发放的原子性操作
> - **可选方案A（紧耦合）**：开发快但扩展性差
> - **可选方案B（事件驱动）**：解耦性好，更利于维护和扩展
>
> **2. 数据与依赖**
> - 用户主数据（用户ID、等级）
> - 订单/交易核心数据（订单号、金额、状态）
> - 优惠券系统数据（券ID、库存、发放接口）
> - **强依赖**：用户服务、订单服务、支付回调服务、优惠券发放服务
>
> **3. 工作量评估**
> - **开发复杂度**：中高。涉及多系统协作、需要保证事务一致性的账户系统
> - **大致时间范围**：3-4人/周团队配置下，预计需要 **3-4周**
>
> **4. 技术风险与挑战**
> - 并发与数据一致性问题（防止超发、少发）
> - 对账复杂性（流水必须与订单、优惠券记录严格对齐）
> - 规则引擎的灵活性（支持动态配置）
>
> **5. 需要产品澄清的问题**
> - 积分计算规则：消费1元等于多少积分？是否有上限？
> - 积分过期与清零规则：积分是否会过期？清理策略是什么？
> - 优惠券兑换的具体规则：固定面额还是积分商城模式？

---

### 用例2：开发视角输入（开发→产品）

**输入**：
```
我们优化了数据库索引，查询性能提升了50%
```

**输出**：

> **🎯 识别结果**
>
> **当前识别为**：【开发→产品】
>
> **识别依据**：输入内容使用了明确的技术术语（"数据库索引"、"查询性能"），并关注技术实现的成果（性能提升百分比），属于典型的技术成果汇报视角。
>
> ---
>
> **📝 翻译内容**
>
> **1. 用户体验影响**
>
> 本次优化最直接的体现是**系统响应速度显著提升**。无论是用户在APP内浏览列表、进行搜索，还是在后台管理页面筛选数据，相关的数据加载和查询操作都会**感觉更快、更流畅**。
>
> **2. 业务价值**
> - **提升用户满意度与留存**：更快的响应速度能有效减少用户等待的烦躁感
> - **支撑更高业务并发**：在促销活动或用户访问高峰时段，系统能更从容地应对压力，减少卡顿和超时的风险
> - **释放数据处理潜力**：为未来上线更复杂的数据分析、个性化推荐等功能奠定基础
>
> **3. 成本与效率**
> - **资源利用更高效**：同样的查询请求对数据库服务器的压力更小，有助于降低服务器扩容成本
> - **研发与运维效率**：因性能问题引发的用户投诉和紧急工单会减少
>
> **4. 可宣传的亮点**
>
> **一句话总结**："我们完成了核心数据库的性能调优，将关键查询效率提升了50%，为用户提供了更迅捷流畅的使用体验，也为业务的稳定增长夯实了技术地基。"
>
> **5. 后续可能性**
> - **体验可度量**：可以将"页面加载速度"加入产品核心监控指标
> - **模式可复制**：本次优化经验可推广到其他性能瓶颈场景
> - **功能新空间**：为规划需要实时计算、复杂筛选的新功能提供了技术信心

---

## 🧠 提示词设计说明

### 如何让 AI 理解"产品视角"和"开发视角"的差异？

核心思路是**从词汇、句式、关注点三个维度**建立清晰的识别规则：

| 维度 | 产品视角特征 | 开发视角特征 |
|-----|------------|------------|
| **词汇信号** | 用户、体验、转化率、需求、功能、场景、痛点、价值 | API、数据库、缓存、QPS、延迟、并发、重构、优化 |
| **句式信号** | "我们想要/需要..."、"用户希望..."、"目标是提升..." | "我们优化了/实现了..."、"性能提升了...%"、"通过...技术解决了..." |
| **关注点信号** | 讨论「做什么」而非「怎么做」，强调用户价值或商业目标 | 讨论「怎么做」或「做了什么」，强调技术指标或实现细节 |

### 提示词中的关键设计点

1. **角色定义明确**
   - 不是通用助手，而是"研发效能协作智能体"
   - 核心定位：帮助产品经理和开发工程师消除沟通鸿沟

2. **四类场景识别**
   - **业务语言**：触发产品→开发翻译
   - **技术语言**：触发开发→产品翻译
   - **信息不足**：触发追问流程
   - **无法识别**：触发友好拒绝

3. **结构化翻译框架**
   - 产品→开发：5维度（技术方案、数据依赖、工作量、风险、待确认问题）
   - 开发→产品：5维度（用户体验、业务价值、成本效率、宣传亮点、后续可能）
   - 强制覆盖所有维度，确保翻译完整性

4. **认知框架转译原则**
   ```
   不是简单的文字转换，而是「认知框架的转译」
   帮助双方看到对方「脑中浮现的那幅画」
   ```

5. **质量保障机制**
   - 宁可追问，也不给低质量翻译
   - 诚实面对能力边界，不强行处理无关内容
   - 对不确定的评估，明确标注"需确认"或"预估"

6. **上下文处理**
   - 多轮对话中累积信息综合判断
   - 避免重复之前已说过的内容
   - 保持翻译内容与之前讨论的逻辑连贯
