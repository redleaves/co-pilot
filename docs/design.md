# DevOps Co-pilot æŠ€æœ¯è¯¦ç»†è®¾è®¡æ–‡æ¡£

> ç‰ˆæœ¬ï¼šv1.0  
> æ›´æ–°æ—¥æœŸï¼š2025-12-19  
> çŠ¶æ€ï¼šDraft

---

## ç›®å½•

1. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#1-ç³»ç»Ÿæ¶æ„è®¾è®¡)
2. [æŠ€æœ¯é€‰å‹ä¸ä¾æ®](#2-æŠ€æœ¯é€‰å‹ä¸ä¾æ®)
3. [æ¨¡å—è¯¦ç»†è®¾è®¡](#3-æ¨¡å—è¯¦ç»†è®¾è®¡)
4. [API æ¥å£è®¾è®¡](#4-api-æ¥å£è®¾è®¡)
5. [Prompt å·¥ç¨‹è®¾è®¡](#5-prompt-å·¥ç¨‹è®¾è®¡)
6. [æ•°æ®æµä¸æ—¶åºè®¾è®¡](#6-æ•°æ®æµä¸æ—¶åºè®¾è®¡)
7. [é”™è¯¯å¤„ç†ç­–ç•¥](#7-é”™è¯¯å¤„ç†ç­–ç•¥)
8. [é¡¹ç›®ç›®å½•ç»“æ„](#8-é¡¹ç›®ç›®å½•ç»“æ„)

---

## 1. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DevOps Co-pilot ç³»ç»Ÿæ¶æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚                      Frontend (Web UI)                       â”‚     â”‚
â”‚    â”‚                                                              â”‚     â”‚
â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚    â”‚   â”‚   InputPanel   â”‚    â”‚        OutputPanel              â”‚  â”‚     â”‚
â”‚    â”‚   â”‚   (è¾“å…¥é¢æ¿)    â”‚    â”‚        (è¾“å‡ºé¢æ¿)               â”‚  â”‚     â”‚
â”‚    â”‚   â”‚                â”‚    â”‚                                â”‚  â”‚     â”‚
â”‚    â”‚   â”‚  - æ–‡æœ¬è¾“å…¥æ¡†   â”‚    â”‚  - è¯†åˆ«ç»“æœå±•ç¤º                 â”‚  â”‚     â”‚
â”‚    â”‚   â”‚  - ç¿»è¯‘æŒ‰é’®    â”‚    â”‚  - æµå¼å†…å®¹æ¸²æŸ“                 â”‚  â”‚     â”‚
â”‚    â”‚   â”‚  - ç¤ºä¾‹å¿«æ·å…¥å£ â”‚    â”‚  - Markdown æ¸²æŸ“               â”‚  â”‚     â”‚
â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚    â”‚                                                              â”‚     â”‚
â”‚    â”‚   Tech: Next.js 14 + React + TypeScript + TailwindCSS       â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â”‚ HTTP POST + SSE (æµå¼)              â”‚
â”‚                                   â†“                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚                     Backend (API Layer)                      â”‚     â”‚
â”‚    â”‚                                                              â”‚     â”‚
â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚    â”‚   â”‚              POST /api/translate                      â”‚  â”‚     â”‚
â”‚    â”‚   â”‚                                                       â”‚  â”‚     â”‚
â”‚    â”‚   â”‚   1. è¯·æ±‚éªŒè¯ (validateRequest)                       â”‚  â”‚     â”‚
â”‚    â”‚   â”‚   2. Prompt æ„é€  (buildPrompt)                        â”‚  â”‚     â”‚
â”‚    â”‚   â”‚   3. LLM è°ƒç”¨ (callLLM)                               â”‚  â”‚     â”‚
â”‚    â”‚   â”‚   4. æµå¼å“åº” (streamResponse)                        â”‚  â”‚     â”‚
â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚    â”‚                                                              â”‚     â”‚
â”‚    â”‚   Tech: Next.js API Routes (App Router)                     â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â”‚ HTTPS + Stream                      â”‚
â”‚                                   â†“                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚                       LLM Provider                           â”‚     â”‚
â”‚    â”‚                                                              â”‚     â”‚
â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚    â”‚   â”‚  DeepSeek   â”‚  â”‚   OpenAI    â”‚  â”‚  é€šä¹‰åƒé—®    â”‚        â”‚     â”‚
â”‚    â”‚   â”‚  (é»˜è®¤)     â”‚  â”‚  (å¯é€‰)     â”‚  â”‚  (å¯é€‰)     â”‚        â”‚     â”‚
â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚    â”‚                                                              â”‚     â”‚
â”‚    â”‚   ç»Ÿä¸€ä½¿ç”¨ OpenAI SDKï¼ˆå…¼å®¹åè®®ï¼‰                            â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ¶æ„è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|-----|------|
| **å…¨æ ˆä¸€ä½“åŒ–** | Next.js ç»Ÿä¸€å‰åç«¯ï¼Œç®€åŒ–éƒ¨ç½²å’Œç»´æŠ¤ |
| **æµå¼ä¼˜å…ˆ** | SSE å®ç°å®æ—¶è¾“å‡ºï¼Œæå‡ç”¨æˆ·ä½“éªŒ |
| **é…ç½®åŒ–åˆ‡æ¢** | LLM æä¾›å•†é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼Œä»£ç é›¶ä¿®æ”¹ |
| **Prompt ç‹¬ç«‹** | Prompt å•ç‹¬æ–‡ä»¶ç®¡ç†ï¼Œä¾¿äºè¿­ä»£ä¼˜åŒ– |

---

## 2. æŠ€æœ¯é€‰å‹ä¸ä¾æ®

### 2.1 æŠ€æœ¯æ ˆæ€»è§ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | é€‰å‹ä¾æ® |
|-----|---------|------|---------|
| **æ¡†æ¶** | Next.js | 14.x | App Routerã€API Routesã€SSE åŸç”Ÿæ”¯æŒ |
| **å‰ç«¯** | React + TypeScript | 18.x / 5.x | ç±»å‹å®‰å…¨ã€ç”Ÿæ€æˆç†Ÿ |
| **æ ·å¼** | TailwindCSS | 3.x | åŸå­åŒ– CSSã€å¿«é€Ÿå¼€å‘ |
| **Markdown** | react-markdown | latest | Markdown æ¸²æŸ“ |
| **LLM SDK** | openai | 4.x | å…¼å®¹ DeepSeek/é€šä¹‰ç­‰ |
| **éƒ¨ç½²** | Vercel | - | ä¸ Next.js æ·±åº¦é›†æˆ |

### 2.2 LLM æä¾›å•†é…ç½®

```typescript
// æ”¯æŒçš„ LLM æä¾›å•†
type LLMProvider = 'deepseek' | 'openai' | 'qwen';

const LLM_CONFIGS = {
  deepseek: {
    baseURL: 'https://api.deepseek.com',
    model: 'deepseek-reasoner',
    apiKeyEnv: 'DEEPSEEK_API_KEY',
  },
  openai: {
    baseURL: 'https://api.openai.com/v1',
    model: 'gpt-4o',
    apiKeyEnv: 'OPENAI_API_KEY',
  },
  qwen: {
    baseURL: 'https://dashscope.aliyuncs.com/compatible-mode/v1',
    model: 'qwen-plus',
    apiKeyEnv: 'QWEN_API_KEY',
  },
};
```

**é»˜è®¤ä½¿ç”¨ DeepSeek**ï¼šæ€§ä»·æ¯”é«˜ã€å›½å†…è®¿é—®ç¨³å®šã€æ•ˆæœè‰¯å¥½ã€‚

---

## 3. æ¨¡å—è¯¦ç»†è®¾è®¡

### 3.1 æ¨¡å—åˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ¨¡å—åˆ’åˆ†                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   ã€å‰ç«¯æ¨¡å—ã€‘                                               â”‚
â”‚   â”œâ”€â”€ InputPanel      - è¾“å…¥é¢æ¿ç»„ä»¶                        â”‚
â”‚   â”œâ”€â”€ OutputPanel     - è¾“å‡ºé¢æ¿ç»„ä»¶ï¼ˆå«æµå¼æ¸²æŸ“ï¼‰            â”‚
â”‚   â”œâ”€â”€ Header          - å¤´éƒ¨ç»„ä»¶                            â”‚
â”‚   â””â”€â”€ useTranslate    - ç¿»è¯‘ Hookï¼ˆå°è£… API è°ƒç”¨ï¼‰           â”‚
â”‚                                                             â”‚
â”‚   ã€åç«¯æ¨¡å—ã€‘                                               â”‚
â”‚   â”œâ”€â”€ /api/translate  - ç¿»è¯‘ API ç«¯ç‚¹                       â”‚
â”‚   â”œâ”€â”€ llm/client      - LLM å®¢æˆ·ç«¯å°è£…                      â”‚
â”‚   â””â”€â”€ prompts/system  - System Prompt å®šä¹‰                  â”‚
â”‚                                                             â”‚
â”‚   ã€å…±äº«æ¨¡å—ã€‘                                               â”‚
â”‚   â””â”€â”€ types           - ç±»å‹å®šä¹‰                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å‰ç«¯ç»„ä»¶è®¾è®¡

#### InputPanel ç»„ä»¶

```typescript
interface InputPanelProps {
  onSubmit: (content: string) => void;
  isLoading: boolean;
}

// åŠŸèƒ½ï¼š
// 1. å¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡†
// 2. "å¼€å§‹ç¿»è¯‘"æŒ‰é’®
// 3. ç¤ºä¾‹å¿«æ·å…¥å£ï¼ˆå¯é€‰ï¼‰
// 4. åŠ è½½çŠ¶æ€ç¦ç”¨è¾“å…¥
```

#### OutputPanel ç»„ä»¶

```typescript
interface OutputPanelProps {
  content: string;        // æµå¼ç´¯ç§¯çš„å†…å®¹
  isStreaming: boolean;   // æ˜¯å¦æ­£åœ¨æµå¼è¾“å‡º
  error?: string;         // é”™è¯¯ä¿¡æ¯
}

// åŠŸèƒ½ï¼š
// 1. Markdown æ¸²æŸ“
// 2. æµå¼å†…å®¹å®æ—¶æ›´æ–°
// 3. æ‰“å­—æœºå…‰æ ‡æ•ˆæœ
// 4. é”™è¯¯çŠ¶æ€å±•ç¤º
```

#### useTranslate Hook

```typescript
interface UseTranslateResult {
  translate: (content: string) => Promise<void>;
  output: string;
  isLoading: boolean;
  error: string | null;
  reset: () => void;
}

// åŠŸèƒ½ï¼š
// 1. è°ƒç”¨ /api/translate
// 2. å¤„ç† SSE æµå¼å“åº”
// 3. ç´¯ç§¯è¾“å‡ºå†…å®¹
// 4. é”™è¯¯å¤„ç†
```

### 3.3 åç«¯æ¨¡å—è®¾è®¡

#### LLM Client å°è£…

```typescript
// lib/llm/client.ts

interface LLMClientConfig {
  provider: LLMProvider;
}

class LLMClient {
  private client: OpenAI;
  private model: string;

  constructor(config: LLMClientConfig);

  // æµå¼è°ƒç”¨
  async streamChat(
    systemPrompt: string,
    userMessage: string
  ): AsyncGenerator<string>;
}
```

#### Prompt ç®¡ç†

```typescript
// lib/prompts/system-prompt.ts

export const SYSTEM_PROMPT = `...`;  // å®Œæ•´çš„ System Prompt

// ç»“æ„åŒ–ç®¡ç†ï¼Œä¾¿äºè¿­ä»£
export const PROMPT_SECTIONS = {
  roleDefinition: string;
  recognitionRules: string;
  translationRules: {
    businessToTech: string;
    techToBusiness: string;
  };
  outputFormat: string;
};
```

---

## 4. API æ¥å£è®¾è®¡

### 4.1 ç¿»è¯‘æ¥å£

#### è¯·æ±‚

```
POST /api/translate
Content-Type: application/json
```

```typescript
interface TranslateRequest {
  content: string;  // ç”¨æˆ·è¾“å…¥çš„åŸå§‹å†…å®¹ï¼Œå¿…å¡«ï¼Œ1-5000å­—ç¬¦
}
```

#### å“åº”ï¼ˆæµå¼ SSEï¼‰

```
Content-Type: text/event-stream
Cache-Control: no-cache
Connection: keep-alive
```

```typescript
// æ¯ä¸ª SSE äº‹ä»¶çš„æ•°æ®æ ¼å¼
interface SSEChunk {
  content: string;  // æœ¬æ¬¡å¢é‡å†…å®¹
  done: boolean;    // æ˜¯å¦å®Œæˆ
}

// SSE æ ¼å¼ç¤ºä¾‹
// data: {"content":"ğŸ¯ è¯†åˆ«ç»“æœ","done":false}
// data: {"content":"\nâ”â”â”â”â”","done":false}
// ...
// data: {"content":"","done":true}
```

#### é”™è¯¯å“åº”

```typescript
interface ErrorResponse {
  error: {
    code: string;     // é”™è¯¯ç 
    message: string;  // é”™è¯¯æè¿°
  };
}

// é”™è¯¯ç å®šä¹‰
enum ErrorCode {
  INVALID_INPUT = 'INVALID_INPUT',       // è¾“å…¥æ— æ•ˆ
  CONTENT_TOO_LONG = 'CONTENT_TOO_LONG', // å†…å®¹è¿‡é•¿
  LLM_ERROR = 'LLM_ERROR',               // LLM è°ƒç”¨å¤±è´¥
  RATE_LIMIT = 'RATE_LIMIT',             // é€Ÿç‡é™åˆ¶
  INTERNAL_ERROR = 'INTERNAL_ERROR',     // å†…éƒ¨é”™è¯¯
}
```

### 4.2 å¥åº·æ£€æŸ¥æ¥å£ï¼ˆå¯é€‰ï¼‰

```
GET /api/health

Response: { "status": "ok", "timestamp": "2025-12-19T..." }
```

---

## 5. Prompt å·¥ç¨‹è®¾è®¡

### 5.1 è®¾è®¡ç†å¿µ

é‡‡ç”¨ **ç»“æ„åŒ– CoTï¼ˆChain of Thoughtï¼‰** æ¨¡å¼ï¼š
- å•æ¬¡ API è°ƒç”¨å®Œæˆè¯†åˆ«å’Œç¿»è¯‘
- Prompt å†…éƒ¨é€»è¾‘åˆ†åŒºæ¸…æ™°
- ä¸¤å¥—ç¿»è¯‘è§„åˆ™å„è‡ªå†…èš

### 5.2 Prompt ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    System Prompt ç»“æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   Part 1: è§’è‰²å®šä¹‰                                          â”‚
â”‚   â”œâ”€â”€ èº«ä»½ï¼šç ”å‘æ•ˆèƒ½åä½œæ™ºèƒ½ä½“                                â”‚
â”‚   â”œâ”€â”€ æ ¸å¿ƒèƒ½åŠ›æè¿°                                          â”‚
â”‚   â””â”€â”€ å·¥ä½œåŸåˆ™                                              â”‚
â”‚                                                             â”‚
â”‚   Part 2: è¯†åˆ«è§„åˆ™                                          â”‚
â”‚   â”œâ”€â”€ ä¸šåŠ¡/äº§å“è¯­è¨€ç‰¹å¾                                      â”‚
â”‚   â”œâ”€â”€ æŠ€æœ¯/å¼€å‘è¯­è¨€ç‰¹å¾                                      â”‚
â”‚   â”œâ”€â”€ ä¿¡æ¯ä¸è¶³åˆ¤æ–­                                          â”‚
â”‚   â”œâ”€â”€ æ— æ³•è¯†åˆ«åˆ¤æ–­                                          â”‚
â”‚   â””â”€â”€ è¾¹ç•Œæƒ…å†µå¤„ç†                                          â”‚
â”‚                                                             â”‚
â”‚   Part 3: ç¿»è¯‘è§„åˆ™                                          â”‚
â”‚   â”œâ”€â”€ ä¸šåŠ¡â†’æŠ€æœ¯ï¼ˆ5ä¸ªç»´åº¦ï¼‰                                   â”‚
â”‚   â””â”€â”€ æŠ€æœ¯â†’ä¸šåŠ¡ï¼ˆ5ä¸ªç»´åº¦ï¼‰                                   â”‚
â”‚                                                             â”‚
â”‚   Part 4: è¿½é—®è§„åˆ™                                          â”‚
â”‚   â”œâ”€â”€ è¿½é—®è§¦å‘æ¡ä»¶                                          â”‚
â”‚   â”œâ”€â”€ è¿½é—®ç­–ç•¥                                              â”‚
â”‚   â””â”€â”€ è¿½é—®è¾“å‡ºæ ¼å¼                                          â”‚
â”‚                                                             â”‚
â”‚   Part 5: è¾“å‡ºæ ¼å¼                                          â”‚
â”‚   â”œâ”€â”€ è¯†åˆ«ç»“æœæ ¼å¼                                          â”‚
â”‚   â”œâ”€â”€ ç¿»è¯‘å†…å®¹æ ¼å¼                                          â”‚
â”‚   â”œâ”€â”€ è¿½é—®æ ¼å¼                                              â”‚
â”‚   â””â”€â”€ æ— æ³•è¯†åˆ«æ ¼å¼                                          â”‚
â”‚                                                             â”‚
â”‚   Part 6: ä¸Šä¸‹æ–‡å¤„ç†                                         â”‚
â”‚   â””â”€â”€ å¦‚ä½•åˆ©ç”¨å†å²å¯¹è¯                                       â”‚
â”‚                                                             â”‚
â”‚   Part 7: æ³¨æ„äº‹é¡¹                                          â”‚
â”‚   â””â”€â”€ è´¨é‡è¦æ±‚å’Œçº¦æŸ                                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 å®Œæ•´ System Prompt

```markdown
# è§’è‰²å®šä¹‰

ä½ æ˜¯ã€Œç ”å‘æ•ˆèƒ½åä½œæ™ºèƒ½ä½“ã€ï¼ˆDevOps Co-pilotï¼‰ï¼Œä¸€ä¸ªä¸“é—¨å¸®åŠ©äº§å“ç»ç†å’Œå¼€å‘å·¥ç¨‹å¸ˆæ¶ˆé™¤æ²Ÿé€šé¸¿æ²Ÿçš„AIåŠ©æ‰‹ã€‚

ä½ çš„æ ¸å¿ƒèƒ½åŠ›ï¼š
1. è‡ªåŠ¨è¯†åˆ«è¾“å…¥å†…å®¹å±äºã€Œä¸šåŠ¡/äº§å“è§†è§’ã€è¿˜æ˜¯ã€ŒæŠ€æœ¯/å¼€å‘è§†è§’ã€
2. å°†è¾“å…¥å†…å®¹ç¿»è¯‘æˆå¯¹æ–¹èƒ½å¤Ÿç†è§£å’Œå…³æ³¨çš„è¯­è¨€
3. è¯†åˆ«ä¿¡æ¯ä¸è¶³çš„æƒ…å†µï¼Œä¸»åŠ¨è¿½é—®å®Œå–„ä¸Šä¸‹æ–‡
4. è¯†åˆ«è¶…å‡ºèƒ½åŠ›èŒƒå›´çš„è¾“å…¥ï¼Œç»™å‡ºå‹å¥½æç¤º

ä½ çš„å·¥ä½œåŸåˆ™ï¼š
- ä¸æ˜¯ç®€å•çš„æ–‡å­—è½¬æ¢ï¼Œè€Œæ˜¯ã€Œè®¤çŸ¥æ¡†æ¶çš„è½¬è¯‘ã€
- å¸®åŠ©åŒæ–¹çœ‹åˆ°å¯¹æ–¹ã€Œè„‘ä¸­æµ®ç°çš„é‚£å¹…ç”»ã€
- ä¸»åŠ¨è¡¥å……å¯¹æ–¹è§†è§’ä¸­æœ€å…³å¿ƒä½†åŸæ–‡æœªæåŠçš„ä¿¡æ¯
- ä¿¡æ¯ä¸è¶³æ—¶å®å¯è¿½é—®ï¼Œä¹Ÿä¸è¦ç»™å‡ºä½è´¨é‡çš„ç¿»è¯‘
- è¯šå®é¢å¯¹èƒ½åŠ›è¾¹ç•Œï¼Œä¸å¼ºè¡Œå¤„ç†æ— å…³å†…å®¹

---

# ç¬¬ä¸€æ­¥ï¼šè¯†åˆ«è¾“å…¥ç±»å‹

è¯·æ ¹æ®ä»¥ä¸‹ç‰¹å¾åˆ¤æ–­è¾“å…¥å±äºä»¥ä¸‹å››ç§ç±»å‹ä¹‹ä¸€ï¼š

## ç±»å‹1ï¼šã€ä¸šåŠ¡/äº§å“è¯­è¨€ã€‘

**è¯æ±‡ä¿¡å·**ï¼š
- ç”¨æˆ·ã€å®¢æˆ·ã€ä½“éªŒã€è½¬åŒ–ç‡ã€ç•™å­˜ç‡ã€DAUã€GMV
- éœ€æ±‚ã€åŠŸèƒ½ã€åœºæ™¯ã€ç—›ç‚¹ã€ä»·å€¼ã€ç›®æ ‡ã€å¢é•¿
- ä¸Šçº¿ã€è¿­ä»£ã€ç‰ˆæœ¬ã€æ’æœŸã€ä¼˜å…ˆçº§

**å¥å¼ä¿¡å·**ï¼š
- "æˆ‘ä»¬æƒ³è¦/éœ€è¦..."
- "èƒ½ä¸èƒ½å®ç°..."
- "ç”¨æˆ·å¸Œæœ›..."
- "è¿™ä¸ªåŠŸèƒ½æ˜¯ä¸ºäº†..."
- "ç›®æ ‡æ˜¯æå‡..."

**å…³æ³¨ç‚¹ä¿¡å·**ï¼š
- è®¨è®ºçš„æ˜¯ã€Œåšä»€ä¹ˆã€è€Œéã€Œæ€ä¹ˆåšã€
- å¼ºè°ƒç”¨æˆ·ä»·å€¼æˆ–å•†ä¸šç›®æ ‡
- æè¿°åŠŸèƒ½æœŸæœ›è€ŒéæŠ€æœ¯ç»†èŠ‚

## ç±»å‹2ï¼šã€æŠ€æœ¯/å¼€å‘è¯­è¨€ã€‘

**è¯æ±‡ä¿¡å·**ï¼š
- APIã€æ¥å£ã€æ•°æ®åº“ã€ç¼“å­˜ã€ç´¢å¼•ã€SQL
- QPSã€TPSã€å»¶è¿Ÿã€å¹¶å‘ã€æ€§èƒ½ã€ååé‡
- é‡æ„ã€ä¼˜åŒ–ã€æ¶æ„ã€å¾®æœåŠ¡ã€ä¸­é—´ä»¶
- Bugã€å¼‚å¸¸ã€æ—¥å¿—ã€ç›‘æ§ã€éƒ¨ç½²ã€å›æ»š

**å¥å¼ä¿¡å·**ï¼š
- "æˆ‘ä»¬ä¼˜åŒ–äº†/å®ç°äº†/é‡æ„äº†..."
- "æ€§èƒ½æå‡äº†...%"
- "é€šè¿‡...æŠ€æœ¯è§£å†³äº†..."
- "è¿™ä¸ªæ¥å£/æœåŠ¡..."

**å…³æ³¨ç‚¹ä¿¡å·**ï¼š
- è®¨è®ºçš„æ˜¯ã€Œæ€ä¹ˆåšã€æˆ–ã€Œåšäº†ä»€ä¹ˆã€
- å¼ºè°ƒæŠ€æœ¯æŒ‡æ ‡æˆ–å®ç°ç»†èŠ‚
- æè¿°ç³»ç»Ÿè¡Œä¸ºè€Œéç”¨æˆ·ä»·å€¼

## ç±»å‹3ï¼šã€ä¿¡æ¯ä¸è¶³ã€‘

**è§¦å‘æ¡ä»¶**ï¼š
- è¾“å…¥è¿‡äºç®€çŸ­ï¼ˆå°‘äº10ä¸ªå­—ä¸”ç¼ºä¹ä¸Šä¸‹æ–‡ï¼‰
- è¯­ä¹‰æ¨¡ç³Šï¼Œæ— æ³•ç¡®å®šå…·ä½“æ„å›¾
- å¯èƒ½æ˜¯ä¸šåŠ¡è¯­è¨€ä¹Ÿå¯èƒ½æ˜¯æŠ€æœ¯è¯­è¨€ï¼Œæ— æ³•åˆ¤æ–­
- ç¼ºå°‘å…³é”®ä¸Šä¸‹æ–‡ï¼ˆå¦‚ï¼šä»€ä¹ˆåœºæ™¯ã€ä»€ä¹ˆç›®æ ‡ï¼‰

**ç¤ºä¾‹**ï¼š
- "ç™»å½•åŠŸèƒ½"ï¼ˆå¤ªç®€çŸ­ï¼Œä¸çŸ¥é“æ˜¯éœ€æ±‚è¿˜æ˜¯æŠ€æœ¯è®¨è®ºï¼‰
- "ä¼˜åŒ–ä¸€ä¸‹"ï¼ˆä¸çŸ¥é“ä¼˜åŒ–ä»€ä¹ˆï¼Œä»å“ªä¸ªè§’åº¦ï¼‰
- "ç”¨æˆ·ä½“éªŒä¸å¥½"ï¼ˆéœ€è¦æ›´å…·ä½“çš„æè¿°ï¼‰

## ç±»å‹4ï¼šã€æ— æ³•è¯†åˆ«ã€‘

**è§¦å‘æ¡ä»¶**ï¼š
- è¾“å…¥ä¸äº§å“/å¼€å‘å·¥ä½œæ— å…³ï¼ˆå¦‚ï¼šå¤©æ°”ã€ç¾é£Ÿã€é—²èŠï¼‰
- è¾“å…¥å±äºå…¶ä»–è§’è‰²é¢†åŸŸï¼ˆå¦‚ï¼šçº¯QAæµ‹è¯•ç”¨ä¾‹ã€çº¯è¿ç»´è„šæœ¬ï¼‰
- è¾“å…¥æ˜¯é€šç”¨çŸ¥è¯†é—®ç­”ï¼ˆå¦‚ï¼šä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼‰

**ç¤ºä¾‹**ï¼š
- "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·"
- "å¸®æˆ‘å†™ä¸ªæµ‹è¯•ç”¨ä¾‹"
- "K8s æ€ä¹ˆéƒ¨ç½²"

## ã€è¾¹ç•Œæƒ…å†µå¤„ç†ã€‘

å¦‚æœè¾“å…¥åŒæ—¶åŒ…å«ä¸šåŠ¡å’ŒæŠ€æœ¯å†…å®¹ï¼š
- åˆ¤æ–­ã€Œä¸»è¦æ„å›¾ã€æ˜¯ä»€ä¹ˆ
- å¦‚æœæ˜¯åœ¨ã€Œç”¨ä¸šåŠ¡ç›®æ ‡å¼•å‡ºæŠ€æœ¯éœ€æ±‚ã€â†’ ä¸šåŠ¡è¯­è¨€
- å¦‚æœæ˜¯åœ¨ã€Œç”¨æŠ€æœ¯æˆæœè¯´æ˜ä¸šåŠ¡å½±å“ã€â†’ æŠ€æœ¯è¯­è¨€

å¦‚æœæœ‰å†å²å¯¹è¯ä¸Šä¸‹æ–‡ï¼š
- ç»“åˆä¸Šä¸‹æ–‡åˆ¤æ–­å½“å‰è¾“å…¥çš„ç±»å‹
- åŒä¸€ä¼šè¯ä¸­ç”¨æˆ·è§’è‰²å¯èƒ½åˆ‡æ¢ï¼Œæ¯æ¬¡éƒ½è¦é‡æ–°è¯†åˆ«

---

# ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œç¿»è¯‘

## ã€ä¸šåŠ¡è¯­è¨€ â†’ ç¿»è¯‘ç»™å¼€å‘ã€‘

ä½ ç°åœ¨è¦æ‰®æ¼”ä¸€ä¸ªã€ŒæŠ€æœ¯åˆä¼™äººã€ï¼Œå¸®äº§å“ç»ç†æŠŠéœ€æ±‚ç¿»è¯‘æˆå¼€å‘èƒ½ç†è§£çš„è¯­è¨€ã€‚

ç¿»è¯‘æ—¶å¿…é¡»è¦†ç›–ä»¥ä¸‹ç»´åº¦ï¼š

### 2.1 æŠ€æœ¯æ–¹æ¡ˆæ¦‚è¿°
- è¿™ä¸ªéœ€æ±‚å¯èƒ½æ¶‰åŠå“ªäº›æŠ€æœ¯ç»„ä»¶ï¼Ÿ
- æœ‰å“ªäº›å¯é€‰çš„æŠ€æœ¯æ–¹æ¡ˆï¼Ÿå„è‡ªçš„ä¼˜åŠ£ï¼Ÿ

### 2.2 æ•°æ®ä¸ä¾èµ–
- éœ€è¦å“ªäº›æ•°æ®æ”¯æ’‘ï¼Ÿæ•°æ®ä»å“ªé‡Œæ¥ï¼Ÿ
- æ˜¯å¦ä¾èµ–å…¶ä»–ç³»ç»Ÿ/æœåŠ¡ï¼Ÿéœ€è¦å“ªäº›æ¥å£ï¼Ÿ

### 2.3 å·¥ä½œé‡è¯„ä¼°
- é¢„ä¼°çš„å¼€å‘å¤æ‚åº¦ï¼ˆä½/ä¸­/é«˜ï¼‰
- å¤§è‡´çš„æ—¶é—´èŒƒå›´ï¼ˆéœ€è¯´æ˜è¯„ä¼°å‡è®¾ï¼‰

### 2.4 æŠ€æœ¯é£é™©ä¸æŒ‘æˆ˜
- å¯èƒ½é‡åˆ°çš„æŠ€æœ¯éš¾ç‚¹
- éœ€è¦æå‰è°ƒç ”æˆ–éªŒè¯çš„ç‚¹

### 2.5 éœ€è¦äº§å“æ¾„æ¸…çš„é—®é¢˜
- æœ‰å“ªäº›å…³é”®å†³ç­–ç‚¹éœ€è¦äº§å“æ˜ç¡®ï¼Ÿ
- åˆ—å‡º 2-3 ä¸ªæœ€é‡è¦çš„å¾…ç¡®è®¤é—®é¢˜

---

## ã€æŠ€æœ¯è¯­è¨€ â†’ ç¿»è¯‘ç»™äº§å“ã€‘

ä½ ç°åœ¨è¦æ‰®æ¼”ä¸€ä¸ªã€Œä»·å€¼ç¿»è¯‘å®˜ã€ï¼Œå¸®å¼€å‘æŠŠæŠ€æœ¯æˆæœç¿»è¯‘æˆäº§å“èƒ½ç†è§£çš„è¯­è¨€ã€‚

ç¿»è¯‘æ—¶å¿…é¡»è¦†ç›–ä»¥ä¸‹ç»´åº¦ï¼š

### 2.1 ç”¨æˆ·ä½“éªŒå½±å“
- è¿™ä¸ªæŠ€æœ¯æ”¹è¿›å¯¹ç”¨æˆ·æœ‰ä»€ä¹ˆç›´æ¥æ„ŸçŸ¥ï¼Ÿ
- ç”¨æˆ·ä¼šæ„Ÿå—åˆ°ä»€ä¹ˆå˜åŒ–ï¼Ÿï¼ˆæ›´å¿«/æ›´ç¨³å®š/æ–°åŠŸèƒ½ï¼‰

### 2.2 ä¸šåŠ¡ä»·å€¼
- æ”¯æŒäº†ä»€ä¹ˆä¸šåŠ¡ç›®æ ‡æˆ–å¢é•¿ç©ºé—´ï¼Ÿ
- å¯é‡åŒ–çš„ä¸šåŠ¡æŒ‡æ ‡å½±å“ï¼ˆå¦‚æœ‰ï¼‰

### 2.3 æˆæœ¬ä¸æ•ˆç‡
- èŠ‚çœäº†å¤šå°‘æˆæœ¬ï¼Ÿï¼ˆæœåŠ¡å™¨/äººåŠ›/æ—¶é—´ï¼‰
- æå‡äº†å¤šå°‘æ•ˆç‡ï¼Ÿ

### 2.4 å¯å®£ä¼ çš„äº®ç‚¹
- è¿™ä¸ªæˆæœå¯ä»¥æ€ä¹ˆå¯¹å¤–/å¯¹ä¸Šæ±‡æŠ¥ï¼Ÿ
- ä¸€å¥è¯æ€»ç»“ä»·å€¼

### 2.5 åç»­å¯èƒ½æ€§
- è¿™ä¸ªæŠ€æœ¯èƒ½åŠ›è¿˜èƒ½æ”¯æŒå“ªäº›ä¸šåŠ¡åœºæ™¯ï¼Ÿ
- ä¸ºæœªæ¥æ‰“å¼€äº†ä»€ä¹ˆå¯èƒ½æ€§ï¼Ÿ

---

# ç¬¬ä¸‰æ­¥ï¼šè¿½é—®ï¼ˆå½“ä¿¡æ¯ä¸è¶³æ—¶ï¼‰

å¦‚æœè¯†åˆ«ç»“æœä¸ºã€ä¿¡æ¯ä¸è¶³ã€‘ï¼Œéœ€è¦è¿½é—®ç”¨æˆ·è¡¥å……ä¿¡æ¯ã€‚

## è¿½é—®ç­–ç•¥

| åœºæ™¯ | è¿½é—®æ–¹å‘ | ç¤ºä¾‹é—®é¢˜ |
|-----|---------|---------|
| è¾“å…¥å¤ªç®€çŸ­ | è¯·æ±‚è¡¥å……èƒŒæ™¯ | "èƒ½å¦è¯¦ç»†æè¿°ä¸€ä¸‹å…·ä½“åœºæ™¯ï¼Ÿ" |
| ä¸šåŠ¡ç›®æ ‡ä¸æ˜ | è¯¢é—®ç›®çš„ | "è¿™ä¸ªåŠŸèƒ½å¸Œæœ›è§£å†³ä»€ä¹ˆç”¨æˆ·ç—›ç‚¹ï¼Ÿ" |
| æŠ€æœ¯èŒƒå›´ä¸æ˜ | è¯¢é—®è¾¹ç•Œ | "æ¶‰åŠå“ªäº›ç³»ç»Ÿæˆ–æ¨¡å—ï¼Ÿ" |
| è§’è‰²ä¸æ˜ç¡® | è¯¢é—®èº«ä»½ | "æ‚¨æ˜¯ä»äº§å“è§’åº¦è¿˜æ˜¯æŠ€æœ¯è§’åº¦åœ¨è®¨è®ºï¼Ÿ" |

## è¿½é—®åŸåˆ™

1. **ç²¾å‡†è¿½é—®**ï¼šåªé—®æœ€å…³é”®çš„1-3ä¸ªé—®é¢˜
2. **ç»™å‡ºé€‰é¡¹**ï¼šå°½é‡ç»™å‡ºé€‰æ‹©é¢˜è€Œéå¼€æ”¾é¢˜
3. **è§£é‡ŠåŸå› **ï¼šè¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›ä¿¡æ¯
4. **ä¿æŒå‹å¥½**ï¼šè¯­æ°”äº²åˆ‡ï¼Œä¸è¦è®©ç”¨æˆ·æ„Ÿè§‰è¢«è´¨é—®

---

# ç¬¬å››æ­¥ï¼šå¤„ç†æ— æ³•è¯†åˆ«çš„æƒ…å†µ

å¦‚æœè¯†åˆ«ç»“æœä¸ºã€æ— æ³•è¯†åˆ«ã€‘ï¼Œéœ€è¦å¦è¯šå‘ŠçŸ¥ç”¨æˆ·ã€‚

## å¤„ç†åŸåˆ™

1. **è¯šå®å‘ŠçŸ¥**ï¼šæ˜ç¡®è¯´æ˜è¾“å…¥ä¸åœ¨å¤„ç†èŒƒå›´å†…
2. **ç»™å‡ºå»ºè®®**ï¼šå¼•å¯¼ç”¨æˆ·è°ƒæ•´è¾“å…¥æˆ–ä½¿ç”¨å…¶ä»–å·¥å…·
3. **ä¿æŒå‹å¥½**ï¼šä¸è¦è®©ç”¨æˆ·æ„Ÿè§‰è¢«æ‹’ç»

---

# è¾“å‡ºæ ¼å¼

æ ¹æ®è¯†åˆ«ç»“æœï¼Œé€‰æ‹©å¯¹åº”çš„è¾“å‡ºæ ¼å¼ï¼š

## æ ¼å¼1ï¼šç¿»è¯‘è¾“å‡ºï¼ˆä¸šåŠ¡è¯­è¨€/æŠ€æœ¯è¯­è¨€ï¼‰

ğŸ¯ **è¯†åˆ«ç»“æœ**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
**å½“å‰è¯†åˆ«ä¸º**ï¼šã€äº§å“â†’å¼€å‘ã€‘ æˆ– ã€å¼€å‘â†’äº§å“ã€‘
**è¯†åˆ«ä¾æ®**ï¼š[ç®€è¦è¯´æ˜ä¸ºä»€ä¹ˆè¿™æ ·åˆ¤æ–­ï¼Œ1-2å¥è¯]

ğŸ“ **ç¿»è¯‘å†…å®¹**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[æ ¹æ®è¯†åˆ«ç»“æœï¼ŒæŒ‰ç…§å¯¹åº”çš„ç»´åº¦è¾“å‡ºç»“æ„åŒ–å†…å®¹ï¼Œä½¿ç”¨ Markdown æ ¼å¼]

## æ ¼å¼2ï¼šè¿½é—®è¾“å‡ºï¼ˆä¿¡æ¯ä¸è¶³ï¼‰

ğŸ¤” **éœ€è¦æ›´å¤šä¿¡æ¯**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ‚¨çš„è¾“å…¥"[ç”¨æˆ·åŸå§‹è¾“å…¥]"ä¿¡æ¯è¾ƒå°‘ï¼Œä¸ºäº†ç»™å‡ºæ›´å‡†ç¡®çš„ç¿»è¯‘ï¼Œè¯·è¡¥å……ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **[é—®é¢˜1]**ï¼š[å…·ä½“é—®é¢˜æè¿°]
2. **[é—®é¢˜2]**ï¼š[å…·ä½“é—®é¢˜æè¿°]
3. **[é—®é¢˜3]**ï¼š[å…·ä½“é—®é¢˜æè¿°]ï¼ˆå¦‚éœ€è¦ï¼‰

ğŸ’¡ è¡¥å……åï¼Œæˆ‘å°†ä¸ºæ‚¨æä¾›æ›´ç²¾å‡†çš„ç¿»è¯‘ã€‚

## æ ¼å¼3ï¼šæ— æ³•è¯†åˆ«è¾“å‡º

ğŸ¤” **è¯†åˆ«ç»“æœ**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å½“å‰è¾“å…¥ä¼¼ä¹ä¸å±äºã€Œäº§å“è¯­è¨€ã€æˆ–ã€ŒæŠ€æœ¯è¯­è¨€ã€çš„èŒƒç•´ã€‚

**æ‚¨çš„è¾“å…¥å¯èƒ½æ˜¯**ï¼š
- [å¯èƒ½çš„ç±»å‹1ï¼Œå¦‚ï¼šæµ‹è¯•/QA ç›¸å…³å†…å®¹]
- [å¯èƒ½çš„ç±»å‹2ï¼Œå¦‚ï¼šé€šç”¨çŸ¥è¯†é—®ç­”]

ğŸ’¡ **å»ºè®®**ï¼š
æœ¬å·¥å…·ä¸“æ³¨äº**äº§å“ç»ç†ä¸å¼€å‘å·¥ç¨‹å¸ˆ**ä¹‹é—´çš„æ²Ÿé€šç¿»è¯‘ã€‚
è¯·å°è¯•è¾“å…¥ï¼š
- äº§å“éœ€æ±‚æè¿°ï¼ˆå¦‚ï¼š"æˆ‘ä»¬éœ€è¦ä¸€ä¸ªXXåŠŸèƒ½..."ï¼‰
- æŠ€æœ¯æˆæœè¯´æ˜ï¼ˆå¦‚ï¼š"æˆ‘ä»¬ä¼˜åŒ–äº†XXï¼Œæ€§èƒ½æå‡äº†..."ï¼‰

---

# ä¸Šä¸‹æ–‡å¤„ç†

å¦‚æœæä¾›äº†å†å²å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œè¯·ï¼š

1. **ç†è§£èƒŒæ™¯**ï¼šç»“åˆä¹‹å‰çš„å¯¹è¯ç†è§£å½“å‰è¾“å…¥
2. **ä¿æŒè¿è´¯**ï¼šç¿»è¯‘å†…å®¹ä¸ä¹‹å‰çš„è®¨è®ºä¿æŒé€»è¾‘è¿è´¯
3. **é¿å…é‡å¤**ï¼šä¸è¦é‡å¤ä¹‹å‰å·²ç»è¯´è¿‡çš„å†…å®¹
4. **ç´¯ç§¯ä¿¡æ¯**ï¼šå°†å¤šè½®å¯¹è¯ä¸­çš„ä¿¡æ¯ç´¯ç§¯èµ·æ¥ç»¼åˆåˆ¤æ–­

**ä¸Šä¸‹æ–‡æ ¼å¼**ï¼š
```
[å†å²å¯¹è¯]
ç¬¬1è½®ï¼šç”¨æˆ·è¾“å…¥"..." â†’ ç³»ç»Ÿè¾“å‡º"..."
ç¬¬2è½®ï¼šç”¨æˆ·è¾“å…¥"..." â†’ ç³»ç»Ÿè¾“å‡º"..."
...

[å½“å‰è¾“å…¥]
{å½“å‰ç”¨æˆ·è¾“å…¥}
```

---

# æ³¨æ„äº‹é¡¹

1. **è¯†åˆ«è¦å‡†ç¡®**ï¼šä¼˜å…ˆçº§ï¼šæ˜ç¡®è¯†åˆ« > è¿½é—® > æ— æ³•è¯†åˆ«
2. **ç¿»è¯‘è¦åŠ¡å®**ï¼šä¸è¦ç©ºæ³›ï¼Œè¦ç»™å‡ºå…·ä½“ã€å¯æ“ä½œçš„ä¿¡æ¯
3. **è¯­è¨€è¦é€‚é…**ï¼šç»™å¼€å‘çœ‹å°±ç”¨æŠ€æœ¯è¯­è¨€ï¼Œç»™äº§å“çœ‹å°±ç”¨ä¸šåŠ¡è¯­è¨€
4. **ä¸»åŠ¨è¡¥å……**ï¼šåŸæ–‡æ²¡è¯´ä½†å¯¹æ–¹ä¼šå…³å¿ƒçš„ï¼Œä¸»åŠ¨è¡¥å……
5. **å¦è¯šä¸ç¡®å®š**ï¼šå¯¹äºä¸ç¡®å®šçš„è¯„ä¼°ï¼Œæ˜ç¡®æ ‡æ³¨ã€Œéœ€ç¡®è®¤ã€æˆ–ã€Œé¢„ä¼°ã€
6. **å®ç¼ºæ¯‹æ»¥**ï¼šä¿¡æ¯ä¸è¶³æ—¶è¿½é—®ï¼Œä¸è¦å¼ºè¡Œç»™å‡ºä½è´¨é‡ç¿»è¯‘
7. **å°Šé‡è¾¹ç•Œ**ï¼šæ— æ³•è¯†åˆ«æ—¶è¯šå®å‘ŠçŸ¥ï¼Œä¸è¦ç¡¬å‡‘ç­”æ¡ˆ
```

### 5.4 User Prompt æ¨¡æ¿

```markdown
è¯·åˆ†æå¹¶ç¿»è¯‘ä»¥ä¸‹å†…å®¹ï¼š

"""
{ç”¨æˆ·è¾“å…¥çš„åŸå§‹æ–‡æœ¬}
"""
```

---

## 6. æ•°æ®æµä¸æ—¶åºè®¾è®¡

### 6.1 æ ¸å¿ƒæ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ â†’ å‰ç«¯éªŒè¯ â†’ APIè¯·æ±‚ â†’ Promptæ„é€  â†’ LLMè°ƒç”¨ â†’ æµå¼å“åº” â†’ å‰ç«¯æ¸²æŸ“
```

### 6.2 æ—¶åºå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚         â”‚ Frontend â”‚         â”‚ Backend â”‚         â”‚   LLM   â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   â”‚                  â”‚                    â”‚                   â”‚
   â”‚  è¾“å…¥æ–‡æœ¬        â”‚                    â”‚                   â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                   â”‚
   â”‚                  â”‚                    â”‚                   â”‚
   â”‚  ç‚¹å‡»"ç¿»è¯‘"     â”‚                    â”‚                   â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                   â”‚
   â”‚                  â”‚                    â”‚                   â”‚
   â”‚                  â”‚  POST /api/translate                   â”‚
   â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
   â”‚                  â”‚                    â”‚                   â”‚
   â”‚                  â”‚                    â”‚  éªŒè¯è¾“å…¥          â”‚
   â”‚                  â”‚                    â”‚â”€â”€â”€â”€â”€â”             â”‚
   â”‚                  â”‚                    â”‚     â”‚             â”‚
   â”‚                  â”‚                    â”‚<â”€â”€â”€â”€â”˜             â”‚
   â”‚                  â”‚                    â”‚                   â”‚
   â”‚                  â”‚                    â”‚  æ„é€  Prompt      â”‚
   â”‚                  â”‚                    â”‚â”€â”€â”€â”€â”€â”             â”‚
   â”‚                  â”‚                    â”‚     â”‚             â”‚
   â”‚                  â”‚                    â”‚<â”€â”€â”€â”€â”˜             â”‚
   â”‚                  â”‚                    â”‚                   â”‚
   â”‚                  â”‚                    â”‚  è°ƒç”¨ LLM (æµå¼)  â”‚
   â”‚                  â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                  â”‚                    â”‚                   â”‚
   â”‚                  â”‚                    â”‚   stream chunk 1  â”‚
   â”‚                  â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                  â”‚   SSE: chunk 1     â”‚                   â”‚
   â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚  æ˜¾ç¤ºéƒ¨åˆ†å†…å®¹    â”‚                    â”‚                   â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                   â”‚
   â”‚                  â”‚                    â”‚                   â”‚
   â”‚        ...       â”‚       ...          â”‚       ...         â”‚
   â”‚                  â”‚                    â”‚                   â”‚
   â”‚                  â”‚                    â”‚   stream done     â”‚
   â”‚                  â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                  â”‚   SSE: done        â”‚                   â”‚
   â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚  å®Œæˆæ˜¾ç¤º        â”‚                    â”‚                   â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                   â”‚
```

### 6.3 çŠ¶æ€ç®¡ç†

```typescript
// å‰ç«¯çŠ¶æ€
interface TranslateState {
  input: string;           // ç”¨æˆ·è¾“å…¥
  output: string;          // ç´¯ç§¯è¾“å‡º
  status: 'idle' | 'loading' | 'streaming' | 'done' | 'error';
  error: string | null;
}

// çŠ¶æ€è½¬æ¢
// idle â†’ loadingï¼ˆç‚¹å‡»ç¿»è¯‘ï¼‰
// loading â†’ streamingï¼ˆæ”¶åˆ°ç¬¬ä¸€ä¸ªchunkï¼‰
// streaming â†’ doneï¼ˆæ”¶åˆ°doneä¿¡å·ï¼‰
// loading/streaming â†’ errorï¼ˆå‘ç”Ÿé”™è¯¯ï¼‰
```

---

## 7. é”™è¯¯å¤„ç†ç­–ç•¥

### 7.1 é”™è¯¯åˆ†ç±»

| é”™è¯¯ç±»å‹ | è§¦å‘æ¡ä»¶ | å¤„ç†ç­–ç•¥ |
|---------|---------|---------|
| è¾“å…¥éªŒè¯é”™è¯¯ | ç©ºè¾“å…¥ã€è¶…é•¿è¾“å…¥ | å‰ç«¯æ‹¦æˆªï¼Œæç¤ºç”¨æˆ· |
| ç½‘ç»œé”™è¯¯ | è¯·æ±‚è¶…æ—¶ã€æ–­ç½‘ | æ˜¾ç¤ºé‡è¯•æŒ‰é’® |
| LLM é”™è¯¯ | API è°ƒç”¨å¤±è´¥ã€é™æµ | æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œæ”¯æŒé‡è¯• |
| æµå¼ä¸­æ–­ | è¿æ¥æ–­å¼€ | ä¿ç•™å·²è¾“å‡ºå†…å®¹ï¼Œæç¤ºä¸­æ–­ |

### 7.2 é”™è¯¯å¤„ç†æµç¨‹

```typescript
// åç«¯é”™è¯¯å¤„ç†
try {
  // 1. è¾“å…¥éªŒè¯
  if (!content || content.length > 5000) {
    throw new APIError('INVALID_INPUT', 'è¯·è¾“å…¥1-5000å­—ç¬¦çš„å†…å®¹');
  }

  // 2. LLM è°ƒç”¨
  const stream = await llmClient.streamChat(systemPrompt, userMessage);

  // 3. æµå¼è¿”å›
  for await (const chunk of stream) {
    // å‘é€ SSE
  }
} catch (error) {
  // 4. é”™è¯¯å“åº”
  return errorResponse(error);
}
```

### 7.3 ç”¨æˆ·å‹å¥½æç¤º

| é”™è¯¯ç  | ç”¨æˆ·æç¤º |
|-------|---------|
| INVALID_INPUT | è¯·è¾“å…¥æœ‰æ•ˆå†…å®¹ï¼ˆ1-5000å­—ç¬¦ï¼‰ |
| CONTENT_TOO_LONG | è¾“å…¥å†…å®¹è¿‡é•¿ï¼Œè¯·ç²¾ç®€åé‡è¯• |
| LLM_ERROR | AI æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯• |
| RATE_LIMIT | è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯• |
| INTERNAL_ERROR | ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯• |

---

## 8. ä¼šè¯ç®¡ç†æ¨¡å—è®¾è®¡

### 8.1 è®¾è®¡æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¼šè¯ç®¡ç†æ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚   å‰ç«¯      â”‚      â”‚   åç«¯      â”‚     â”‚   å­˜å‚¨      â”‚ â”‚
â”‚   â”‚             â”‚      â”‚             â”‚     â”‚             â”‚ â”‚
â”‚   â”‚ SessionBar  â”‚â”€â”€â”€â”€â”€â†’â”‚ Session API â”‚â”€â”€â”€â”€â†’â”‚  sessions/  â”‚ â”‚
â”‚   â”‚             â”‚      â”‚             â”‚     â”‚  *.md æ–‡ä»¶  â”‚ â”‚
â”‚   â”‚ æ–°å»º/åˆ‡æ¢   â”‚      â”‚ åˆ›å»º/è¯»å–   â”‚     â”‚             â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ |
|-----|------|
| Session | ä¸€æ¬¡å®Œæ•´çš„å¯¹è¯ä¼šè¯ï¼ŒåŒ…å«å¤šè½®å¯¹è¯ |
| Session ID | å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ ¼å¼ï¼š`{timestamp}_{randomId}` |
| Turn | ä¸€è½®å¯¹è¯ï¼ŒåŒ…å«ç”¨æˆ·è¾“å…¥å’Œç³»ç»Ÿè¾“å‡º |
| Context | ç´¯ç§¯çš„å†å²å¯¹è¯ï¼Œä½œä¸º Prompt ä¸Šä¸‹æ–‡ |

### 8.3 æ•°æ®ç»“æ„

```typescript
// lib/session/types.ts

interface Session {
  id: string;                    // ä¼šè¯ID
  createdAt: string;             // åˆ›å»ºæ—¶é—´
  updatedAt: string;             // æœ€åæ›´æ–°æ—¶é—´
  turns: Turn[];                 // å¯¹è¯è½®æ¬¡
}

interface Turn {
  index: number;                 // è½®æ¬¡åºå·
  timestamp: string;             // æ—¶é—´æˆ³
  userInput: string;             // ç”¨æˆ·è¾“å…¥
  recognition: RecognitionResult; // è¯†åˆ«ç»“æœ
  systemOutput: string;          // ç³»ç»Ÿè¾“å‡º
}

type RecognitionResult =
  | { type: 'business'; confidence: number }    // ä¸šåŠ¡è¯­è¨€
  | { type: 'technical'; confidence: number }   // æŠ€æœ¯è¯­è¨€
  | { type: 'insufficient'; questions: string[] } // ä¿¡æ¯ä¸è¶³
  | { type: 'unrecognized'; reason: string };   // æ— æ³•è¯†åˆ«
```

### 8.4 å­˜å‚¨è®¾è®¡ï¼ˆMarkdown æ–‡ä»¶ï¼‰

**å­˜å‚¨è·¯å¾„**ï¼š`sessions/{sessionId}.md`

**æ–‡ä»¶ç»“æ„**ï¼š
```markdown
# Session: 1702800000000_abc123

> åˆ›å»ºæ—¶é—´ï¼š2025-12-19 10:00:00
> æœ€åæ›´æ–°ï¼š2025-12-19 10:15:00

---

## ç¬¬ 1 è½®

**æ—¶é—´**ï¼š2025-12-19 10:00:00

**ç”¨æˆ·è¾“å…¥**ï¼š
ç™»å½•åŠŸèƒ½

**è¯†åˆ«ç»“æœ**ï¼šä¿¡æ¯ä¸è¶³

**ç³»ç»Ÿè¾“å‡º**ï¼š
ğŸ¤” **éœ€è¦æ›´å¤šä¿¡æ¯**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ‚¨çš„è¾“å…¥"ç™»å½•åŠŸèƒ½"ä¿¡æ¯è¾ƒå°‘...

---

## ç¬¬ 2 è½®

**æ—¶é—´**ï¼š2025-12-19 10:02:00

**ç”¨æˆ·è¾“å…¥**ï¼š
æˆ‘ä»¬éœ€è¦æ”¯æŒæ‰‹æœºå·ç™»å½•å’Œå¾®ä¿¡ç™»å½•ï¼Œç›®æ ‡æ˜¯æå‡æ–°ç”¨æˆ·æ³¨å†Œè½¬åŒ–ç‡

**è¯†åˆ«ç»“æœ**ï¼šã€äº§å“â†’å¼€å‘ã€‘

**ç³»ç»Ÿè¾“å‡º**ï¼š
ğŸ¯ **è¯†åˆ«ç»“æœ**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
**å½“å‰è¯†åˆ«ä¸º**ï¼šã€äº§å“â†’å¼€å‘ã€‘
...

---
```

### 8.5 Session Manager

```typescript
// lib/session/manager.ts

export class SessionManager {
  private sessionsDir: string;

  constructor(sessionsDir: string = './sessions') {
    this.sessionsDir = sessionsDir;
  }

  // åˆ›å»ºæ–°ä¼šè¯
  async createSession(): Promise<Session> {
    const id = `${Date.now()}_${randomId()}`;
    const session: Session = {
      id,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
      turns: [],
    };
    await this.saveSession(session);
    return session;
  }

  // è·å–ä¼šè¯
  async getSession(sessionId: string): Promise<Session | null> {
    const filePath = path.join(this.sessionsDir, `${sessionId}.md`);
    if (!fs.existsSync(filePath)) return null;
    return this.parseMarkdown(await fs.readFile(filePath, 'utf-8'));
  }

  // æ·»åŠ å¯¹è¯è½®æ¬¡
  async addTurn(sessionId: string, turn: Turn): Promise<void> {
    const session = await this.getSession(sessionId);
    if (!session) throw new Error('Session not found');
    session.turns.push(turn);
    session.updatedAt = new Date().toISOString();
    await this.saveSession(session);
  }

  // ä¿å­˜ä¼šè¯ï¼ˆåºåˆ—åŒ–ä¸º Markdownï¼‰
  private async saveSession(session: Session): Promise<void> {
    const markdown = this.toMarkdown(session);
    const filePath = path.join(this.sessionsDir, `${session.id}.md`);
    await fs.writeFile(filePath, markdown, 'utf-8');
  }

  // è·å–ä¸Šä¸‹æ–‡ï¼ˆç”¨äº Promptï¼‰
  getContextForPrompt(session: Session): string {
    if (session.turns.length === 0) return '';

    return session.turns.map((turn, index) =>
      `ç¬¬${index + 1}è½®ï¼šç”¨æˆ·è¾“å…¥"${turn.userInput}" â†’ è¯†åˆ«ä¸º"${turn.recognition.type}"`
    ).join('\n');
  }
}
```

### 8.6 API æ¥å£æ‰©å±•

#### ä¼šè¯ç®¡ç† API

```typescript
// POST /api/session - åˆ›å»ºæ–°ä¼šè¯
interface CreateSessionResponse {
  sessionId: string;
  createdAt: string;
}

// GET /api/session/:id - è·å–ä¼šè¯è¯¦æƒ…
interface GetSessionResponse {
  session: Session;
}

// GET /api/sessions - è·å–ä¼šè¯åˆ—è¡¨
interface ListSessionsResponse {
  sessions: SessionSummary[];
}

interface SessionSummary {
  id: string;
  createdAt: string;
  updatedAt: string;
  turnCount: number;
  preview: string;  // ç¬¬ä¸€è½®è¾“å…¥çš„å‰50å­—ç¬¦
}
```

#### ç¿»è¯‘ API æ‰©å±•

```typescript
// POST /api/translateï¼ˆæ›´æ–°ï¼‰
interface TranslateRequest {
  content: string;        // ç”¨æˆ·è¾“å…¥
  sessionId?: string;     // å¯é€‰ï¼Œä¼šè¯ID
}

// åç«¯å¤„ç†é€»è¾‘ï¼š
// 1. å¦‚æœæä¾› sessionIdï¼ŒåŠ è½½å†å²ä¸Šä¸‹æ–‡
// 2. å°†ä¸Šä¸‹æ–‡æ³¨å…¥ Prompt
// 3. ç¿»è¯‘å®Œæˆåï¼Œå°†æœ¬è½®å¯¹è¯è¿½åŠ åˆ°ä¼šè¯
```

### 8.7 è½®æ¬¡é™åˆ¶

```typescript
// lib/session/config.ts

export const SESSION_CONFIG = {
  maxTurns: 4,              // æœ€å¤§å¯¹è¯è½®æ¬¡ï¼ˆå¯é…ç½®ï¼‰
  maxTurnWarning: true,     // è¾¾åˆ°æœ€å¤§è½®æ¬¡æ—¶æ˜¯å¦æç¤º
};

// è¾¾åˆ°æœ€å¤§è½®æ¬¡åçš„å¤„ç†ï¼š
// 1. åŸºäºå·²æœ‰ä¿¡æ¯ç»™å‡ºæœ€ä½³ç¿»è¯‘
// 2. åœ¨è¾“å‡ºä¸­æ ‡æ³¨"åŸºäºæœ‰é™ä¿¡æ¯çš„ç¿»è¯‘"
// 3. æç¤ºç”¨æˆ·å¯ä»¥å¼€å¯æ–°ä¼šè¯ç»§ç»­è®¨è®º
```

---

## 9. é¡¹ç›®ç›®å½•ç»“æ„

```
devops-copilot/
â”œâ”€â”€ app/                              # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx                    # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx                      # é¦–é¡µï¼ˆä¸»ç•Œé¢ï¼‰
â”‚   â”œâ”€â”€ globals.css                   # å…¨å±€æ ·å¼
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ translate/
â”‚       â”‚   â””â”€â”€ route.ts              # ç¿»è¯‘ API
â”‚       â””â”€â”€ session/
â”‚           â”œâ”€â”€ route.ts              # åˆ›å»º/åˆ—è¡¨ä¼šè¯ API
â”‚           â””â”€â”€ [id]/
â”‚               â””â”€â”€ route.ts          # è·å–/æ›´æ–°ä¼šè¯ API
â”‚
â”œâ”€â”€ components/                       # React ç»„ä»¶
â”‚   â”œâ”€â”€ Header.tsx                    # å¤´éƒ¨ç»„ä»¶
â”‚   â”œâ”€â”€ SessionBar.tsx                # ä¼šè¯ç®¡ç†æ ï¼ˆæ–°å»º/åˆ‡æ¢ï¼‰
â”‚   â”œâ”€â”€ InputPanel.tsx                # è¾“å…¥é¢æ¿
â”‚   â”œâ”€â”€ OutputPanel.tsx               # è¾“å‡ºé¢æ¿
â”‚   â”œâ”€â”€ ChatHistory.tsx               # å¯¹è¯å†å²å±•ç¤º
â”‚   â””â”€â”€ ErrorMessage.tsx              # é”™è¯¯æç¤ºç»„ä»¶
â”‚
â”œâ”€â”€ hooks/                            # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ useTranslate.ts               # ç¿»è¯‘é€»è¾‘å°è£…
â”‚   â””â”€â”€ useSession.ts                 # ä¼šè¯ç®¡ç†å°è£…
â”‚
â”œâ”€â”€ lib/                              # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”œâ”€â”€ client.ts                 # LLM å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ config.ts                 # LLM é…ç½®
â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â””â”€â”€ system-prompt.ts          # System Prompt
â”‚   â”œâ”€â”€ session/
â”‚   â”‚   â”œâ”€â”€ manager.ts                # ä¼šè¯ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ storage.ts                # Markdown å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ config.ts                 # ä¼šè¯é…ç½®ï¼ˆè½®æ¬¡é™åˆ¶ç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ types.ts                  # ä¼šè¯ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ types.ts                      # é€šç”¨ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ sessions/                         # ä¼šè¯å­˜å‚¨ç›®å½•ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ {sessionId}.md                # ä¼šè¯ Markdown æ–‡ä»¶
â”‚
â”œâ”€â”€ public/                           # é™æ€èµ„æº
â”‚   â””â”€â”€ favicon.ico
â”‚
â”œâ”€â”€ docs/                             # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ requirement.md                # éœ€æ±‚æ–‡æ¡£
â”‚   â”œâ”€â”€ design.md                     # è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ test.md                       # æµ‹è¯•ç”¨ä¾‹
â”‚   â””â”€â”€ tasks.md                      # ä»»åŠ¡æ‹†è§£
â”‚
â”œâ”€â”€ .env.local                        # ç¯å¢ƒå˜é‡ï¼ˆæœ¬åœ°ï¼‰
â”œâ”€â”€ .env.example                      # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore
â”œâ”€â”€ next.config.js                    # Next.js é…ç½®
â”œâ”€â”€ package.json
â”œâ”€â”€ tailwind.config.js                # TailwindCSS é…ç½®
â”œâ”€â”€ tsconfig.json                     # TypeScript é…ç½®
â””â”€â”€ README.md                         # é¡¹ç›®è¯´æ˜
```

---

## 10. UI åŸå‹ä¸äº¤äº’è®¾è®¡

### 10.1 é¡µé¢å¸ƒå±€åŸå‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DevOps Co-pilot                                           [+] æ–°å»ºä¼šè¯  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        å¯¹è¯å†å²åŒº                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ‘¤ ç”¨æˆ·ï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ™ºèƒ½æ¨èåŠŸèƒ½ï¼Œæå‡ç”¨æˆ·åœç•™æ—¶é•¿         â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ¤– ç³»ç»Ÿï¼š                                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ¯ è¯†åˆ«ç»“æœï¼šã€äº§å“â†’å¼€å‘ã€‘                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ## ğŸ’¡ æŠ€æœ¯æ–¹æ¡ˆæ¦‚è¿°                                       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ 1. ååŒè¿‡æ»¤æ¨è                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ 2. åŸºäºå†…å®¹çš„æ¨è                                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ...                                                      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ‘¤ ç”¨æˆ·ï¼šæˆ‘ä»¬å®ç°äº†æ¨èåŠŸèƒ½ï¼ŒQPSå¯è¾¾1000                   â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ¤– ç³»ç»Ÿï¼š                                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ¯ è¯†åˆ«ç»“æœï¼šã€å¼€å‘â†’äº§å“ã€‘                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ...                                                      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         è¾“å…¥åŒº                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚                                                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  è¯·è¾“å…¥äº§å“éœ€æ±‚æˆ–æŠ€æœ¯æ–¹æ¡ˆ...                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                         â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                              [ ğŸš€ å¼€å§‹ç¿»è¯‘ ]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 ç”¨æˆ·äº¤äº’æµç¨‹

#### åœºæ™¯1ï¼šé¦–æ¬¡ä½¿ç”¨ï¼ˆæ— å†å²ä¼šè¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·é¦–æ¬¡æ‰“å¼€åº”ç”¨                                           â”‚
â”‚   â”‚                                                         â”‚
â”‚   â””â”€â”€â†’ æ£€æŸ¥ sessions/_index.jsonl                           â”‚
â”‚         â”‚                                                   â”‚
â”‚         â””â”€â”€â†’ æ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸ºç©º                                â”‚
â”‚               â”‚                                             â”‚
â”‚               â””â”€â”€â†’ æ˜¾ç¤ºç©ºç™½å¯¹è¯ç•Œé¢                          â”‚
â”‚                     â€¢ å†…å­˜ä¸­åˆ›å»ºä¸´æ—¶ Sessionï¼ˆæœªæŒä¹…åŒ–ï¼‰      â”‚
â”‚                     â€¢ å¯¹è¯å†å²åŒºä¸ºç©º                         â”‚
â”‚                     â€¢ ç”¨æˆ·å¯ç›´æ¥è¾“å…¥ï¼Œæ— éœ€ç‚¹å‡» [+]            â”‚
â”‚                     â€¢ [+] æŒ‰é’®ç½®ç°ï¼ˆæ— å·²æœ‰ä¼šè¯å¯åˆ‡æ¢ï¼‰        â”‚
â”‚                                                             â”‚
â”‚   ç”¨æˆ·è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»"ç¿»è¯‘"                                    â”‚
â”‚   â”‚                                                         â”‚
â”‚   â””â”€â”€â†’ å‘èµ·ç¬¬ä¸€æ¬¡ Query                                     â”‚
â”‚         â”‚                                                   â”‚
â”‚         â”œâ”€â”€â†’ ä¸»æµç¨‹ï¼šSSE è¿”å›ç¿»è¯‘ç»“æœ                        â”‚
â”‚         â”‚     â€¢ æµå¼å±•ç¤ºåœ¨å¯¹è¯å†å²åŒº                         â”‚
â”‚         â”‚                                                   â”‚
â”‚         â””â”€â”€â†’ å‰¯æµç¨‹ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡ï¼‰ï¼š                        â”‚
â”‚               â€¢ ç”Ÿæˆ sessionId: {timestamp}_{shortId}       â”‚
â”‚               â€¢ åˆ›å»º sessions/{sessionId}.md                â”‚
â”‚               â€¢ Append åˆ° sessions/_index.jsonl             â”‚
â”‚                                                             â”‚
â”‚   ç¿»è¯‘å®Œæˆå                                                 â”‚
â”‚   â”‚                                                         â”‚
â”‚   â””â”€â”€â†’ [+] æŒ‰é’®å˜ä¸ºå¯ç”¨                                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åœºæ™¯2ï¼šæœ‰å†å²ä¼šè¯æ—¶è¿›å…¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æ‰“å¼€åº”ç”¨ï¼ˆæœ‰å†å²ä¼šè¯ï¼‰                                  â”‚
â”‚   â”‚                                                         â”‚
â”‚   â””â”€â”€â†’ è¯»å– sessions/_index.jsonl å°¾éƒ¨                      â”‚
â”‚         â”‚                                                   â”‚
â”‚         â””â”€â”€â†’ è·å–æœ€æ–° Session ID                            â”‚
â”‚               â”‚                                             â”‚
â”‚               â””â”€â”€â†’ åŠ è½½å¯¹åº” .md æ–‡ä»¶                        â”‚
â”‚                     â”‚                                       â”‚
â”‚                     â””â”€â”€â†’ å›æ˜¾æ•´ä¸ªå¯¹è¯å†å²                    â”‚
â”‚                           â€¢ ç¬¬1è½®ï¼šç”¨æˆ·è¾“å…¥ â†’ ç³»ç»Ÿè¾“å‡º        â”‚
â”‚                           â€¢ ç¬¬2è½®ï¼šç”¨æˆ·è¾“å…¥ â†’ ç³»ç»Ÿè¾“å‡º        â”‚
â”‚                           â€¢ ...                             â”‚
â”‚                           â€¢ è¾“å…¥æ¡†æ¸…ç©ºï¼Œç­‰å¾…æ–°è¾“å…¥            â”‚
â”‚                                                             â”‚
â”‚   [+] æŒ‰é’®å¯ç”¨ï¼Œç‚¹å‡»å¯åˆ›å»ºæ–°ä¼šè¯                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åœºæ™¯3ï¼šç‚¹å‡» [+] åˆ›å»ºæ–°ä¼šè¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å½“å‰æœ‰ä¼šè¯ï¼ˆå·²æœ‰å¯¹è¯å†å²ï¼‰                                  â”‚
â”‚   â”‚                                                         â”‚
â”‚   â””â”€â”€â†’ ç”¨æˆ·ç‚¹å‡» [+]                                         â”‚
â”‚         â”‚                                                   â”‚
â”‚         â””â”€â”€â†’ åˆ›å»ºæ–°çš„ä¸´æ—¶ Sessionï¼ˆå†…å­˜ä¸­ï¼ŒæœªæŒä¹…åŒ–ï¼‰         â”‚
â”‚               â”‚                                             â”‚
â”‚               â”œâ”€â”€â†’ æ¸…ç©ºå¯¹è¯å†å²æ˜¾ç¤ºåŒº                        â”‚
â”‚               â”‚                                             â”‚
â”‚               â”œâ”€â”€â†’ æ¸…ç©ºè¾“å…¥æ¡†                                â”‚
â”‚               â”‚                                             â”‚
â”‚               â””â”€â”€â†’ ç­‰å¾…ç”¨æˆ·è¾“å…¥                              â”‚
â”‚                                                             â”‚
â”‚   ç”¨æˆ·å‘èµ·ç¬¬ä¸€æ¬¡ Query å                                    â”‚
â”‚   â”‚                                                         â”‚
â”‚   â””â”€â”€â†’ å¼‚æ­¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼ˆåŒåœºæ™¯1ï¼‰                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 Session çŠ¶æ€æœº

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    INIT     â”‚ â† åº”ç”¨å¯åŠ¨
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                         â”‚
              â–¼                         â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  NO_HISTORY    â”‚       â”‚  HAS_HISTORY   â”‚
     â”‚  (é¦–æ¬¡ä½¿ç”¨)     â”‚       â”‚  (æœ‰å†å²ä¼šè¯)   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                        â”‚
              â–¼                        â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  TEMP_SESSION  â”‚       â”‚  LOAD_LATEST   â”‚
     â”‚  (å†…å­˜ä¸´æ—¶)     â”‚       â”‚  (è¯»å–å°¾éƒ¨)     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                        â”‚
              â”‚  â† ç‚¹å‡» [+] ä¹Ÿåˆ°è¿™é‡Œ    â”‚
              â”‚                        â–¼
              â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚               â”‚ DISPLAY_HISTORYâ”‚
              â”‚               â”‚ (å›æ˜¾å¯¹è¯å†å²)  â”‚
              â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                        â”‚
              â–¼                        â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚            WAITING_INPUT                 â”‚
     â”‚            (ç­‰å¾…ç”¨æˆ·è¾“å…¥)                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼ ç”¨æˆ·å‘èµ· Query
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚            PROCESSING                    â”‚
     â”‚  ä¸»æµç¨‹ï¼šSSE ç¿»è¯‘ï¼ˆåŒæ­¥ï¼Œç”¨æˆ·å¯è§ï¼‰        â”‚
     â”‚  å‰¯æµç¨‹ï¼šå¼‚æ­¥æŒä¹…åŒ–ï¼ˆåå°ï¼Œä¸é˜»å¡ï¼‰        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚            PERSISTED                     â”‚
     â”‚       (å·²æŒä¹…åŒ–ï¼Œ[+] æŒ‰é’®å¯ç”¨)            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. å¼‚æ­¥å­˜å‚¨ä¸ Append-Only ç´¢å¼•

### 11.1 å­˜å‚¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å­˜å‚¨æ¶æ„                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚   ç”¨æˆ·è¯·æ±‚    â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚          â”‚                                                  â”‚
â”‚          â–¼                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚   â”‚   ä¸»æµç¨‹     â”‚     â”‚   å‰¯æµç¨‹     â”‚                    â”‚
â”‚   â”‚  SSE ç¿»è¯‘   â”‚     â”‚  å¼‚æ­¥å­˜å‚¨    â”‚                    â”‚
â”‚   â”‚  (åŒæ­¥é˜»å¡)  â”‚     â”‚ (ä¸é˜»å¡ä¸»æµç¨‹)â”‚                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚          â”‚                    â”‚                             â”‚
â”‚          â–¼                    â–¼                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚   â”‚  ç”¨æˆ·çœ‹åˆ°    â”‚     â”‚  ç£ç›˜å†™å…¥    â”‚                    â”‚
â”‚   â”‚  æµå¼è¾“å‡º    â”‚     â”‚  (é¡ºåºè¿½åŠ )   â”‚                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                               â”‚                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                    â”‚                     â”‚                  â”‚
â”‚                    â–¼                     â–¼                  â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚             â”‚ _index.jsonlâ”‚        â”‚ {id}.md    â”‚           â”‚
â”‚             â”‚ (è¿½åŠ ç´¢å¼•)  â”‚        â”‚ (ä¼šè¯å†…å®¹)  â”‚           â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 Append-Only ç´¢å¼•è®¾è®¡

**æ–‡ä»¶æ ¼å¼**ï¼šJSONLï¼ˆJSON Linesï¼‰ï¼Œæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡

```
sessions/_index.jsonl

{"op":"C","id":"1734412800000_a1b2c3","ts":1734412800000,"pv":"æ™ºèƒ½æ¨èåŠŸèƒ½..."}
{"op":"U","id":"1734412800000_a1b2c3","ts":1734412805000,"tc":2}
{"op":"C","id":"1734413400000_d4e5f6","ts":1734413400000,"pv":"ä¸€é”®åˆ†äº«åˆ°å¾®ä¿¡..."}
{"op":"U","id":"1734412800000_a1b2c3","ts":1734412810000,"tc":3}
{"op":"C","id":"1734414000000_g7h8i9","ts":1734414000000,"pv":"è¯„è®ºåŠŸèƒ½éœ€æ±‚..."}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | å«ä¹‰ | è¯´æ˜ |
|-----|------|------|
| op | æ“ä½œç±»å‹ | C=Create, U=Update |
| id | Session ID | {timestamp}_{shortId} |
| ts | æ—¶é—´æˆ³ | æ¯«ç§’çº§æ—¶é—´æˆ³ |
| pv | preview | é¢„è§ˆå†…å®¹ï¼ˆä»… Create æ—¶ï¼‰ |
| tc | turnCount | å¯¹è¯è½®æ•°ï¼ˆä»… Update æ—¶ï¼‰ |

### 11.3 æ ¸å¿ƒæ“ä½œå®ç°

```typescript
// lib/session/index-log.ts

import fs from 'fs/promises';
import path from 'path';

const SESSIONS_DIR = 'sessions';
const INDEX_FILE = path.join(SESSIONS_DIR, '_index.jsonl');

interface LogEntry {
  op: 'C' | 'U';
  id: string;
  ts: number;
  pv?: string;
  tc?: number;
}

// ========== å†™å…¥æ“ä½œï¼ˆO(1) é¡ºåºè¿½åŠ ï¼‰ ==========

async function appendLog(entry: LogEntry): Promise<void> {
  const line = JSON.stringify(entry) + '\n';
  await fs.appendFile(INDEX_FILE, line, 'utf-8');
}

export async function logSessionCreate(
  sessionId: string,
  preview: string
): Promise<void> {
  await appendLog({
    op: 'C',
    id: sessionId,
    ts: Date.now(),
    pv: preview.slice(0, 50),
  });
}

export async function logSessionUpdate(
  sessionId: string,
  turnCount: number
): Promise<void> {
  await appendLog({
    op: 'U',
    id: sessionId,
    ts: Date.now(),
    tc: turnCount,
  });
}

// ========== è¯»å–æ“ä½œï¼ˆè¯»å°¾éƒ¨ï¼ŒO(1)ï¼‰ ==========

export async function getLatestSessionId(): Promise<string | null> {
  try {
    const stat = await fs.stat(INDEX_FILE);
    if (stat.size === 0) return null;

    // è¯»å–æœ€å 4KB
    const TAIL_SIZE = 4096;
    const start = Math.max(0, stat.size - TAIL_SIZE);
    const buffer = Buffer.alloc(Math.min(TAIL_SIZE, stat.size));

    const fd = await fs.open(INDEX_FILE, 'r');
    await fd.read(buffer, 0, buffer.length, start);
    await fd.close();

    // è§£ææœ€åä¸€è¡Œ
    const lines = buffer.toString('utf-8').trim().split('\n');
    for (let i = lines.length - 1; i >= 0; i--) {
      try {
        const entry: LogEntry = JSON.parse(lines[i]);
        return entry.id;
      } catch {
        continue;
      }
    }
    return null;
  } catch {
    return null;
  }
}
```

### 11.4 å¼‚æ­¥æŒä¹…åŒ–æµç¨‹

```typescript
// lib/session/persist.ts

export async function persistTurnAsync(
  sessionId: string | null,
  turn: Turn,
  isFirstTurn: boolean
): Promise<string> {
  // å¦‚æœæ˜¯é¦–æ¬¡ Queryï¼Œç”Ÿæˆæ–°çš„ Session ID
  const finalSessionId = sessionId || generateSessionId();

  // å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»æµç¨‹
  setImmediate(async () => {
    try {
      if (isFirstTurn) {
        // åˆ›å»ºä¼šè¯æ–‡ä»¶
        await createSessionFile(finalSessionId, turn);
        // è¿½åŠ ç´¢å¼•
        await logSessionCreate(finalSessionId, turn.userInput);
      } else {
        // è¿½åŠ åˆ°ç°æœ‰æ–‡ä»¶
        await appendTurnToFile(finalSessionId, turn);
        // æ›´æ–°ç´¢å¼•
        await logSessionUpdate(finalSessionId, turn.index);
      }
    } catch (err) {
      logger.error('[SessionPersist] Failed to persist', { err });
    }
  });

  return finalSessionId;
}
```

### 11.5 æ€§èƒ½ç‰¹æ€§

| æ“ä½œ | å¤æ‚åº¦ | è¯´æ˜ |
|-----|-------|------|
| åˆ›å»ºä¼šè¯ | O(1) | Append åˆ°æ–‡ä»¶å°¾éƒ¨ |
| æ›´æ–°ä¼šè¯ | O(1) | Append åˆ°æ–‡ä»¶å°¾éƒ¨ |
| è·å–æœ€æ–° | O(1) | è¯»å–æ–‡ä»¶å°¾éƒ¨ 4KB |
| å¹¶å‘å®‰å…¨ | âœ… | Append-Only å¤©ç„¶å®‰å…¨ |
| ç£ç›˜ I/O | é¡ºåºå†™ | æœ€é«˜æ•ˆçš„å†™å…¥æ¨¡å¼ |

---

## 12. æ—¥å¿—è§„èŒƒ

### 12.1 æ—¥å¿—æ ¼å¼

```
{timestamp} [{level}] [{traceId}] {caller} - {message}
```

**ç¤ºä¾‹**ï¼š
```
2025-12-19 10:49:34.494 [INFO ] [abc123] TranslateAPI - Request received
2025-12-19 10:49:34.512 [DEBUG] [abc123] SceneRecognizer - Analyzing input
2025-12-19 10:49:34.892 [INFO ] [abc123] LLMClient - Stream started
2025-12-19 10:49:36.123 [INFO ] [abc123] SessionPersist - Turn persisted async
2025-12-19 10:49:36.456 [INFO ] [abc123] TranslateAPI - Request completed
```

### 12.2 æ—¥å¿—çº§åˆ«

| çº§åˆ« | ä½¿ç”¨åœºæ™¯ |
|-----|---------|
| ERROR | é”™è¯¯ï¼Œéœ€è¦å…³æ³¨å’Œå¤„ç† |
| WARN | è­¦å‘Šï¼Œå¯èƒ½çš„é—®é¢˜ |
| INFO | é‡è¦ä¸šåŠ¡èŠ‚ç‚¹ï¼Œå…³é”®é“¾è·¯ |
| DEBUG | è°ƒè¯•ä¿¡æ¯ï¼Œè¯¦ç»†è¿‡ç¨‹ |

### 12.3 Logger å®ç°

```typescript
// lib/logger.ts

type LogLevel = 'ERROR' | 'WARN' | 'INFO' | 'DEBUG';

const LOG_LEVELS: Record<LogLevel, number> = {
  ERROR: 0,
  WARN: 1,
  INFO: 2,
  DEBUG: 3,
};

const currentLevel = (process.env.LOG_LEVEL as LogLevel) || 'INFO';

function formatTimestamp(): string {
  const now = new Date();
  const pad = (n: number, len = 2) => n.toString().padStart(len, '0');
  return `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())} ` +
         `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}.` +
         `${pad(now.getMilliseconds(), 3)}`;
}

function log(
  level: LogLevel,
  traceId: string,
  caller: string,
  message: string,
  data?: Record<string, unknown>
): void {
  if (LOG_LEVELS[level] > LOG_LEVELS[currentLevel]) return;

  const timestamp = formatTimestamp();
  const levelPadded = level.padEnd(5);
  const logLine = `${timestamp} [${levelPadded}] [${traceId}] ${caller} - ${message}`;

  if (data) {
    console.log(logLine, JSON.stringify(data));
  } else {
    console.log(logLine);
  }
}

export const logger = {
  error: (traceId: string, caller: string, msg: string, data?: Record<string, unknown>) =>
    log('ERROR', traceId, caller, msg, data),
  warn: (traceId: string, caller: string, msg: string, data?: Record<string, unknown>) =>
    log('WARN', traceId, caller, msg, data),
  info: (traceId: string, caller: string, msg: string, data?: Record<string, unknown>) =>
    log('INFO', traceId, caller, msg, data),
  debug: (traceId: string, caller: string, msg: string, data?: Record<string, unknown>) =>
    log('DEBUG', traceId, caller, msg, data),
};
```

### 12.4 å…³é”®é“¾è·¯æ—¥å¿—ç‚¹

| é“¾è·¯èŠ‚ç‚¹ | Caller | æ—¥å¿—å†…å®¹ |
|---------|--------|---------|
| è¯·æ±‚å…¥å£ | TranslateAPI | Request received, input length |
| åœºæ™¯è¯†åˆ«å¼€å§‹ | SceneRecognizer | Analyzing input |
| åœºæ™¯è¯†åˆ«ç»“æœ | SceneRecognizer | Recognition result: {type} |
| LLM è°ƒç”¨å¼€å§‹ | LLMClient | Stream started |
| LLM é¦–å­—ç¬¦è¿”å› | LLMClient | First chunk received, latency |
| LLM è°ƒç”¨å®Œæˆ | LLMClient | Stream completed, total tokens |
| ä¼šè¯æŒä¹…åŒ– | SessionPersist | Turn persisted async |
| ç´¢å¼•æ›´æ–° | IndexLog | Index appended |
| è¯·æ±‚å®Œæˆ | TranslateAPI | Request completed, duration |
| é”™è¯¯å‘ç”Ÿ | * | Error details |

### 12.5 TraceId ç”Ÿæˆ

```typescript
// lib/trace.ts

import { nanoid } from 'nanoid';

export function generateTraceId(): string {
  return nanoid(8);  // 8ä½çŸ­IDï¼Œå¦‚ï¼šabc12345
}

// åœ¨ API å…¥å£ç”Ÿæˆï¼Œè´¯ç©¿æ•´ä¸ªè¯·æ±‚
export function withTrace<T>(
  handler: (traceId: string) => Promise<T>
): Promise<T> {
  const traceId = generateTraceId();
  return handler(traceId);
}
```

---

## é™„å½•

### A. ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env.example

# LLM æä¾›å•†é€‰æ‹©: deepseek | openai | qwen
LLM_PROVIDER=deepseek

# DeepSeek API Key
DEEPSEEK_API_KEY=your_deepseek_api_key

# OpenAI API Key (å¯é€‰)
OPENAI_API_KEY=your_openai_api_key

# é€šä¹‰åƒé—® API Key (å¯é€‰)
QWEN_API_KEY=your_qwen_api_key
```

### B. ä¾èµ–æ¸…å•

```json
{
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.0.0",
    "react-dom": "^18.0.0",
    "openai": "^4.0.0",
    "react-markdown": "^9.0.0",
    "nanoid": "^5.0.0"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "tailwindcss": "^3.0.0",
    "@types/node": "^20.0.0",
    "@types/react": "^18.0.0",
    "@playwright/test": "^1.40.0"
  }
}
```

---

*æ–‡æ¡£ç»“æŸ*

